–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ—Å—Å–∏—è–º–∏:

–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è.
–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –Ω–æ –Ω–∞ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –Ω–∞–∫–ª–∞–¥–Ω—ã–º —Ä–∞—Å—Ö–æ–¥–∞–º.

–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ –≤–µ—Å—å –±–ª–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π: —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ —Å–µ—Ä–∏–µ–π –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π. 
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω—É —Å–µ—Å—Å–∏—é, —á—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

–ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π –ø–æ–¥—Ö–æ–¥, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.


–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤:

üü¢–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–≥ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ú—ã —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –µ–≥–æ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, 
–∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é.

üü¢–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ (—ç–∫–∑–µ–º–ø–ª—è—Ä–∞) ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. 
–ú—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–≥–æ, –ø–µ—Ä–µ–¥–∞–≤–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π —Ç–∞–±–ª–∏—Ü—ã.

üü¢–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±—ä–µ–∫—Ç–æ–º –º–æ–¥–µ–ª–∏ –≤ SQL‚Äë–∑–∞–ø—Ä–æ—Å. 
–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–æ–±—â–∏—Ç –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å.

üü¢–ö–æ–º–º–∏—Ç (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ‚Äî –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∏ —Å–µ—Å—Å–∏—è –∑–Ω–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, 
–º—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–º–æ—â—å—é commit(), —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä:
@connection
async def add_user(name: str, age: int, session):
    # –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç User (–∏–Ω—Å—Ç–∞–Ω—Å –º–æ–¥–µ–ª–∏)
    new_user = User(name=name, age=age)
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –≤ —Å–µ—Å—Å–∏—é
    session.add(new_user)
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    await session.commit()

üü¢–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –í–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ add_user –º—ã —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏ User, –ø–µ—Ä–µ–¥–∞–≤–∞—è –≤ –Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª–µ–π name –∏ age. 
–≠—Ç–æ –∏ –µ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Å—Ç–∞–Ω—Å–∞ ‚Äî –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ. 
–ü–æ–∫–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏, –µ–≥–æ –µ—â—ë –Ω–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

üü¢–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é –ß—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å SQLAlchemy –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É, –º—ã –≤—ã–∑—ã–≤–∞–µ–º session.add(new_user). 
–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç —Å–µ—Å—Å–∏–∏: ¬´–≠—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö¬ª. 
–û–¥–Ω–∞–∫–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –º—ã –Ω–µ –≤—ã–∑–æ–≤–µ–º commit(), –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è. 
–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã —Ñ–æ—Ä–º–∏—Ä—É–µ–º SQL‚Äë–∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –Ω–æ, –ø—Ä–∏ —ç—Ç–æ–º, –º—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–∞–º –∑–∞–ø—Ä–æ—Å.

üü¢–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ await session.commit() ‚Äî —ç—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. 
–ë–µ–∑ —ç—Ç–æ–≥–æ —à–∞–≥–∞ SQLAlchemy –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: await add_user("–ê–ª–µ–∫—Å–µ–π –ü—É–ø–∫–∏–Ω", 31)
–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è add_user, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–º–µ–Ω–µ–º "–ê–ª–µ–∫—Å–µ–π –ü—É–ø–∫–∏–Ω" –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–º 31.
–ë–ª–∞–≥–æ–¥–∞—Ä—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É @connection —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è, –∏ —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.



# python -m app.dao.add_methods

from sqlalchemy.ext.asyncio import AsyncSession
from asyncio import run

from app.core.db import connection
from app.models import User, Profile

from app.models.profiles import Gender,–°urrentGoal,ActivityLevel
from datetime import datetime

@connection
async def create_user_example_1(email: str, username: str, hashed_password: str, session: AsyncSession) -> int:
    """
    –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ORM SQLAlchemy.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    - email: str - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - username: str - –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
    - hashed_password: str - —Ö–µ—à –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - session: AsyncSession - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - int - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    
    user = User(email=email, username=username, hashed_password=hashed_password)
    session.add(user)
    await session.commit()
    return user.id

# new_user_id = run(create_user_example_1(email="bobatea@example.com",
#                                         username="bobatea",
#                                         hashed_password="bobateabobatea"))

# print(f"–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º {new_user_id} —Å–æ–∑–¥–∞–Ω")

@connection
async def get_user_by_id_example_2(email: str, username: str, hashed_password: str,
                                   name: str,
                                   gender: Gender,
                                   weight: float,
                                   height: int,
                                   goal: –°urrentGoal,
                                   birthday_date: datetime | None,
                                   activity_level: ActivityLevel,
                                   session: AsyncSession) -> dict[str, int]:
    user = User(email=email, username=username, hashed_password=hashed_password)
    session.add(user)
    await session.commit()

    profile = Profile(
        user_id=user.id,
        name=name,
        gender=gender,
        weight=weight,
        height=height,
        goal=goal,
        birthday_date=birthday_date,
        activity_level=activity_level)

    session.add(profile)
    await session.commit()
    print(f'–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user.id} –∏ –µ–º—É –ø—Ä–∏—Å–≤–æ–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å —Å ID {profile.id}')
    return {'user_id': user.id, 'profile_id': profile.id}

@connection
async def get_user_by_id_example_3(email: str, username: str, hashed_password: str,
                                   name: str,
                                   gender: Gender,
                                   weight: float,
                                   height: int,
                                   goal: –°urrentGoal,
                                   birthday_date: datetime | None,
                                   activity_level: ActivityLevel,
                                   session: AsyncSession) -> dict[str, int]:
    try:
        user = User(email=email, username=username, hashed_password=hashed_password)
        session.add(user)
        await session.flush()  # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —à–∞–≥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è user.id –±–µ–∑ –∫–æ–º–º–∏—Ç–∞

        profile = Profile(
            user_id=user.id,
            name=name,
            gender=gender,
            weight=weight,
            height=height,
            goal=goal,
            birthday_date=birthday_date,
            activity_level=activity_level)
        
        session.add(profile)

        # –û–¥–∏–Ω –∫–æ–º–º–∏—Ç –¥–ª—è –æ–±–æ–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
        await session.commit()

        print(f'–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user.id} –∏ –µ–º—É –ø—Ä–∏—Å–≤–æ–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å —Å ID {profile.id}')
        return {'user_id': user.id, 'profile_id': profile.id}

    except Exception as e:
        await session.rollback()  # –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
        raise e


user_profile = run(get_user_by_id_example_3(
    email="cofeeman@example.com",
    username="cofeeman",
    hashed_password="cofeeman322",
    name="Jane",
    gender=Gender.FEMALE,
    weight=55.5,
    height=160,
    goal=–°urrentGoal.KEEPING_FIT,
    birthday_date=datetime(2001, 4, 1, 14, 6, 0),
    activity_level=ActivityLevel.ACTIVE
))



–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç flush –≤ SQLAlchemy
flush –≤ SQLAlchemy –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∏—Ö –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏, —Ç–æ –µ—Å—Ç—å –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–∞. 
–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, user.id), 
—á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ. –ü—Ä–∏ —ç—Ç–æ–º —Å–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π, 
–∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ, –ø—Ä–∏ –≤—ã–∑–æ–≤–µ commit.

–ü–æ—á–µ–º—É —ç—Ç–æ –±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:
–†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏: flush –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –±–∞–∑—É –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ, 
–Ω–æ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ user.id 
–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—è –∫–æ–º–º–∏—Ç –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.

–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: –ò—Å–ø–æ–ª—å–∑—É—è flush, –º—ã –∏–∑–±–µ–≥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤. 
–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –æ–¥–Ω–∏–º –∫–æ–º–º–∏—Ç–æ–º –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. 
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π.


–î–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —É–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ add_all. 
–û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–µ—Ç–æ–¥—É add, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ —Å–ø–∏—Å–æ–∫ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤). 
–° –µ–≥–æ –ø–æ–º–æ—â—å—é –º—ã –º–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é. –î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä, 
–≥–¥–µ –¥–æ–±–∞–≤–∏–º –ø—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞.

@connection
async def create_user_example_4(users_data: list[dict], session: AsyncSession) -> list[int]:
    """
    –°–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ORM SQLAlchemy.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    - users_data: list[dict] - —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      –ö–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–∏: 'email', 'username', 'hashed_password'.
    - session: AsyncSession - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - list[int] - —Å–ø–∏—Å–æ–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    """
    users_list = [
        User(
            email=user_data['email'],
            username=user_data['username'],
            hashed_password=user_data['hashed_password']
        )
        for user_data in users_data
    ]
    session.add_all(users_list)
    await session.commit()
    return [user.id for user in users_list]

users = [
    {
        "email": "cofeem1an@example.com",
        "username": "cofeema2n",
        "hashed_password": "cofeema2n322",
    },
    {
        "email": "smithman@example.com",
        "username": "smithman",
        "hashed_password": "smithman456",
    },
    {
        "email": "johnson@example.com",
        "username": "johnson",
        "hashed_password": "johnson789",
    },
    {
        "email": "williams@example.com",
        "username": "williams",
        "hashed_password": "williams012",
    },
    {
        "email": "brown@example.com",
        "username": "brown",
        "hashed_password": "brown345",
    }
]


run(create_user_example_4(users_data=users))
