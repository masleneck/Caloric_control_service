–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ—Å—Å–∏—è–º–∏:

–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è.
–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –Ω–æ –Ω–∞ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –Ω–∞–∫–ª–∞–¥–Ω—ã–º —Ä–∞—Å—Ö–æ–¥–∞–º.

–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ –≤–µ—Å—å –±–ª–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π: —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ —Å–µ—Ä–∏–µ–π –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π. 
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω—É —Å–µ—Å—Å–∏—é, —á—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

–ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π –ø–æ–¥—Ö–æ–¥, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.


–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤:

üü¢–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–≥ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ú—ã —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –µ–≥–æ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, 
–∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é.

üü¢–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ (—ç–∫–∑–µ–º–ø–ª—è—Ä–∞) ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. 
–ú—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–≥–æ, –ø–µ—Ä–µ–¥–∞–≤–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π —Ç–∞–±–ª–∏—Ü—ã.

üü¢–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±—ä–µ–∫—Ç–æ–º –º–æ–¥–µ–ª–∏ –≤ SQL‚Äë–∑–∞–ø—Ä–æ—Å. 
–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–æ–±—â–∏—Ç –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å.

üü¢–ö–æ–º–º–∏—Ç (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ‚Äî –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∏ —Å–µ—Å—Å–∏—è –∑–Ω–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, 
–º—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–º–æ—â—å—é commit(), —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä:
@connection
async def add_user(name: str, age: int, session):
    # –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç User (–∏–Ω—Å—Ç–∞–Ω—Å –º–æ–¥–µ–ª–∏)
    new_user = User(name=name, age=age)
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –≤ —Å–µ—Å—Å–∏—é
    session.add(new_user)
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    await session.commit()

üü¢–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –í–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ add_user –º—ã —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏ User, –ø–µ—Ä–µ–¥–∞–≤–∞—è –≤ –Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª–µ–π name –∏ age. 
–≠—Ç–æ –∏ –µ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Å—Ç–∞–Ω—Å–∞ ‚Äî –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ. 
–ü–æ–∫–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏, –µ–≥–æ –µ—â—ë –Ω–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

üü¢–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é –ß—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å SQLAlchemy –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É, –º—ã –≤—ã–∑—ã–≤–∞–µ–º session.add(new_user). 
–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç —Å–µ—Å—Å–∏–∏: ¬´–≠—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö¬ª. 
–û–¥–Ω–∞–∫–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –º—ã –Ω–µ –≤—ã–∑–æ–≤–µ–º commit(), –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è. 
–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã —Ñ–æ—Ä–º–∏—Ä—É–µ–º SQL‚Äë–∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –Ω–æ, –ø—Ä–∏ —ç—Ç–æ–º, –º—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–∞–º –∑–∞–ø—Ä–æ—Å.

üü¢–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ await session.commit() ‚Äî —ç—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. 
–ë–µ–∑ —ç—Ç–æ–≥–æ —à–∞–≥–∞ SQLAlchemy –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: await add_user("–ê–ª–µ–∫—Å–µ–π –ü—É–ø–∫–∏–Ω", 31)
–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è add_user, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–º–µ–Ω–µ–º "–ê–ª–µ–∫—Å–µ–π –ü—É–ø–∫–∏–Ω" –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–º 31.
–ë–ª–∞–≥–æ–¥–∞—Ä—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É @connection —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è, –∏ —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.



# python -m app.dao.add_methods

from sqlalchemy.ext.asyncio import AsyncSession
from asyncio import run

from app.core.db import connection
from app.models import User, Profile

from app.models.profiles import Gender,–°urrentGoal,ActivityLevel
from datetime import datetime

@connection
async def create_user_example_1(email: str, username: str, hashed_password: str, session: AsyncSession) -> int:
    """
    –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ORM SQLAlchemy.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    - email: str - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - username: str - –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
    - hashed_password: str - —Ö–µ—à –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - session: AsyncSession - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - int - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    
    user = User(email=email, username=username, hashed_password=hashed_password)
    session.add(user)
    await session.commit()
    return user.id

# new_user_id = run(create_user_example_1(email="bobatea@example.com",
#                                         username="bobatea",
#                                         hashed_password="bobateabobatea"))

# print(f"–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º {new_user_id} —Å–æ–∑–¥–∞–Ω")

@connection
async def get_user_by_id_example_2(email: str, username: str, hashed_password: str,
                                   name: str,
                                   gender: Gender,
                                   weight: float,
                                   height: int,
                                   goal: –°urrentGoal,
                                   birthday_date: datetime | None,
                                   activity_level: ActivityLevel,
                                   session: AsyncSession) -> dict[str, int]:
    user = User(email=email, username=username, hashed_password=hashed_password)
    session.add(user)
    await session.commit()

    profile = Profile(
        user_id=user.id,
        name=name,
        gender=gender,
        weight=weight,
        height=height,
        goal=goal,
        birthday_date=birthday_date,
        activity_level=activity_level)

    session.add(profile)
    await session.commit()
    print(f'–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user.id} –∏ –µ–º—É –ø—Ä–∏—Å–≤–æ–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å —Å ID {profile.id}')
    return {'user_id': user.id, 'profile_id': profile.id}

@connection
async def get_user_by_id_example_3(email: str, username: str, hashed_password: str,
                                   name: str,
                                   gender: Gender,
                                   weight: float,
                                   height: int,
                                   goal: –°urrentGoal,
                                   birthday_date: datetime | None,
                                   activity_level: ActivityLevel,
                                   session: AsyncSession) -> dict[str, int]:
    try:
        user = User(email=email, username=username, hashed_password=hashed_password)
        session.add(user)
        await session.flush()  # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —à–∞–≥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è user.id –±–µ–∑ –∫–æ–º–º–∏—Ç–∞

        profile = Profile(
            user_id=user.id,
            name=name,
            gender=gender,
            weight=weight,
            height=height,
            goal=goal,
            birthday_date=birthday_date,
            activity_level=activity_level)
        
        session.add(profile)

        # –û–¥–∏–Ω –∫–æ–º–º–∏—Ç –¥–ª—è –æ–±–æ–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
        await session.commit()

        print(f'–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user.id} –∏ –µ–º—É –ø—Ä–∏—Å–≤–æ–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å —Å ID {profile.id}')
        return {'user_id': user.id, 'profile_id': profile.id}

    except Exception as e:
        await session.rollback()  # –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
        raise e


user_profile = run(get_user_by_id_example_3(
    email="cofeeman@example.com",
    username="cofeeman",
    hashed_password="cofeeman322",
    name="Jane",
    gender=Gender.FEMALE,
    weight=55.5,
    height=160,
    goal=–°urrentGoal.KEEPING_FIT,
    birthday_date=datetime(2001, 4, 1, 14, 6, 0),
    activity_level=ActivityLevel.ACTIVE
))



–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç flush –≤ SQLAlchemy
flush –≤ SQLAlchemy –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∏—Ö –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏, —Ç–æ –µ—Å—Ç—å –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–∞. 
–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, user.id), 
—á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ. –ü—Ä–∏ —ç—Ç–æ–º —Å–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π, 
–∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ, –ø—Ä–∏ –≤—ã–∑–æ–≤–µ commit.

–ü–æ—á–µ–º—É —ç—Ç–æ –±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:
–†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏: flush –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –±–∞–∑—É –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ, 
–Ω–æ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ user.id 
–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—è –∫–æ–º–º–∏—Ç –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.

–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: –ò—Å–ø–æ–ª—å–∑—É—è flush, –º—ã –∏–∑–±–µ–≥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤. 
–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –æ–¥–Ω–∏–º –∫–æ–º–º–∏—Ç–æ–º –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. 
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π.


–î–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —É–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ add_all. 
–û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–µ—Ç–æ–¥—É add, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ —Å–ø–∏—Å–æ–∫ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤). 
–° –µ–≥–æ –ø–æ–º–æ—â—å—é –º—ã –º–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é. –î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä, 
–≥–¥–µ –¥–æ–±–∞–≤–∏–º –ø—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞.

@connection
async def create_user_example_4(users_data: list[dict], session: AsyncSession) -> list[int]:
    """
    –°–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ORM SQLAlchemy.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    - users_data: list[dict] - —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      –ö–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–∏: 'email', 'username', 'hashed_password'.
    - session: AsyncSession - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - list[int] - —Å–ø–∏—Å–æ–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    """
    users_list = [
        User(
            email=user_data['email'],
            username=user_data['username'],
            hashed_password=user_data['hashed_password']
        )
        for user_data in users_data
    ]
    session.add_all(users_list)
    await session.commit()
    return [user.id for user in users_list]

users = [
    {
        "email": "cofeem1an@example.com",
        "username": "cofeema2n",
        "hashed_password": "cofeema2n322",
    },
    {
        "email": "smithman@example.com",
        "username": "smithman",
        "hashed_password": "smithman456",
    },
    {
        "email": "johnson@example.com",
        "username": "johnson",
        "hashed_password": "johnson789",
    },
    {
        "email": "williams@example.com",
        "username": "williams",
        "hashed_password": "williams012",
    },
    {
        "email": "brown@example.com",
        "username": "brown",
        "hashed_password": "brown345",
    }
]


run(create_user_example_4(users_data=users))


–î–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ select(), –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ—á–∫–æ–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
‚úÖ
–ú–µ—Ç–æ–¥ get()
–•–æ—Ç—è –º–µ—Ç–æ–¥ get() —è–≤–ª—è–µ—Ç—Å—è —É–¥–æ–±–Ω—ã–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É, –æ–Ω –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º. 
–ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ –º—ã –Ω–µ –±—É–¥–µ–º –µ–≥–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
‚úÖ
–ú–µ—Ç–æ–¥ select()
–ú—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º–µ—Ç–æ–¥–µ select(), –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª—å—à—É—é –≥–∏–±–∫–æ—Å—Ç—å –∑–∞ —Å—á–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–π.

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞
1. scalars()
–ú–µ—Ç–æ–¥ scalars() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –º—ã –æ–∂–∏–¥–∞–µ–º –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –∞ –Ω–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π. 
–ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –º—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—Å—é –º–æ–¥–µ–ª—å (–∫–∞–∫ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ) –∏–ª–∏ –æ–¥–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).

–ü—Ä–∏–º–µ—Ä:

result = await session.execute(query)
records = result.scalars().all()
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ scalars() –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–±—ä–µ–∫—Ç—ã –º–æ–¥–µ–ª–∏, —Ç–∞–∫ –∫–∞–∫ –º—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—Å—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, User). 
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, id, name, email), —Ç–æ scalars() "–≤—ã–±–µ—Ä–µ—Ç" —Ç–æ–ª—å–∫–æ —Ç—É –∫–æ–ª–æ–Ω–∫—É, 
–∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ (–∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—é, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –∑–∞–ø—Ä–æ—à–µ–Ω–æ).

2. all()

–ú–µ—Ç–æ–¥ all() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç –Ω–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É. 
–ö–æ–≥–¥–∞ –º—ã –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–≥–æ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º scalars(), –º—ã –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã.

–ü—Ä–∏–º–µ—Ä:

records = result.scalars().all()
–ó–¥–µ—Å—å all() –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞. 
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –µ—Å–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, all() –≤–µ—Ä–Ω–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑ 10 –æ–±—ä–µ–∫—Ç–æ–≤ User.

3. first()

–ú–µ—Ç–æ–¥ first() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞. 
–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –∑–∞–ø–∏—Å—å, –∏ –Ω–∞—Å –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

–ü—Ä–∏–º–µ—Ä:

record = result.scalars().first()
–ó–¥–µ—Å—å first() –≤–µ—Ä–Ω–µ—Ç –ø–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∏–ª–∏ None, –µ—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.

4. scalar()

–ú–µ—Ç–æ–¥ scalar() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –º—ã –æ–∂–∏–¥–∞–µ–º –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –∏ –æ–¥–Ω–æ –ø–æ–ª–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∑–∞–ø—Ä–æ—Å–∞. 
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω–µ—Ç –±–æ–ª—å—à–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –º–µ—Ç–æ–¥ –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

–ü—Ä–∏–º–µ—Ä:

record = result.scalar()
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤–µ—Ä–Ω–µ—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤—ã–±–æ—Ä–∫—É –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è.

5. scalar_one() –∏ scalar_one_or_none()

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã –ø–æ—Ö–æ–∂–∏ –Ω–∞ scalar(), –Ω–æ —Å –≤–∞–∂–Ω—ã–º–∏ –æ—Ç–ª–∏—á–∏—è–º–∏:

scalar_one() ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω–µ—Ç –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞.

scalar_one_or_none() ‚Äî –≤–µ—Ä–Ω–µ—Ç –ª–∏–±–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –ª–∏–±–æ None, –µ—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ï—Å–ª–∏ –≤–µ—Ä–Ω–µ—Ç—Å—è –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, —Ç–∞–∫–∂–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞.

–ü—Ä–∏–º–µ—Ä:

record = result.scalar_one_or_none()
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –º—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ–º, —á—Ç–æ –ª–∏–±–æ –±—É–¥–µ—Ç –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å, –ª–∏–±–æ –µ—ë –Ω–µ –±—É–¥–µ—Ç –≤–æ–≤—Å–µ.


–§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–ú–µ—Ç–æ–¥ select –≤ SQLAlchemy —É–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –∫–æ–ª–æ–Ω–∫–∏ –∏–ª–∏ –º–æ–¥–µ–ª–∏ –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç. 
–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å —É—Å–ª–æ–≤–∏—è –≤—ã–±–æ—Ä–∫–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä—ã.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ –∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ SQLAlchemy:

–ú–µ—Ç–æ–¥ where (–∏–ª–∏ filter) ‚Äî –≥–∏–±–∫–∏–π –∏ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. 
–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è. –° –µ–≥–æ –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–≤–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

query = select(User).where(User.age > 18, User.active == True)

–ú–µ—Ç–æ–¥ filter_by ‚Äî –±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π –∏ "—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π" —Å–ø–æ—Å–æ–± —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º –∫–æ–ª–æ–Ω–æ–∫. 
–û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è–º –∫–æ–ª–æ–Ω–æ–∫ –≤ –º–æ–¥–µ–ª–∏, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —É—Å–ª–æ–≤–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞:

query = select(User).filter_by(username="john_doe", active=True)

–•–æ—Ç—è –æ–±–∞ –º–µ—Ç–æ–¥–∞ —Ä–µ—à–∞—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∑–∞–¥–∞—á—É, where (–∏–ª–∏ filter) —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. 

‚úÖ
SQLAlchemy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:

–ü–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ join (—è–≤–Ω—ã–π JOIN –≤ –∑–∞–ø—Ä–æ—Å–µ).

–ü–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ options (–≥–∏–±–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–π).
1. –ü–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ join
–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü —á–µ—Ä–µ–∑ SQL-–∑–∞–ø—Ä–æ—Å —Å —è–≤–Ω—ã–º JOIN. 
–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ ‚Äî —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –∏–∑–±–µ–≥–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã "N+1 –∑–∞–ø—Ä–æ—Å–æ–≤", 
–∫–æ–≥–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è join:

query = select(User).join(Profile).where(User.id == Profile.user_id)
result = await session.execute(query)
users = result.scalars().all()

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è JOIN –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ User –∏ Profile, 
—á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –∏—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö.

2. –ü–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ options
SQLAlchemy —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π —Å–ø–æ—Å–æ–± –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ options(),
–∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–¥–≥—Ä—É–∑–∫–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–¥–≥—Ä—É–∑–∫–∏:
joinedload ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ LEFT OUTER JOIN. –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é lazy="joined" –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ relationship.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è joinedload:

query = select(User).options(joinedload(User.profile))
result = await session.execute(query)
users = result.scalars().all()
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ `JOIN`, –Ω–æ –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –±–æ–ª–µ–µ "—á–∏—Å—Ç–æ",
—Ç–∞–∫ –∫–∞–∫ `JOIN` —Å–∫—Ä—ã—Ç –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏.

subqueryload ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å. 
–ü–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ JOIN –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –∏–ª–∏ –±–æ–ª—å—à–∏—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è subqueryload:

query = select(User).options(subqueryload(User.profile))
result = await session.execute(query)
users = result.scalars().all()
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ 
–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.

selectinload ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º IN, 
—á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è selectinload:

query = select(User).options(selectinload(User.profile))
result = await session.execute(query)
users = result.scalars().all()
–≠—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 
–∞ –∑–∞—Ç–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ IN, 
—á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
‚úÖ
–ü–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ join:

–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —è–≤–Ω—ã—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü.
–û—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Å–ª–æ–∂–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç —è–≤–Ω—ã—Ö relationship –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–∏–±–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ.
‚úÖ
–ü–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ options:

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –≤ –≤—ã–±–æ—Ä–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö (joinedload, subqueryload, selectinload).
–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∑–∞—Ä–∞–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –≤ –º–æ–¥–µ–ª—è—Ö.
–î–∞—ë—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö.